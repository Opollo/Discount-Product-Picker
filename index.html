<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Live Shopping Chatbot</title>
<style>
:root{--primary:#4f46e5;--success:#10b981;--bg:#f8fafc;--text:#1e293b;--border:#e2e8f0;--card:#ffffff;}
*{box-sizing:border-box;}
body{margin:0;font-family:"Segoe UI",sans-serif;background:var(--bg);color:var(--text);display:flex;flex-direction:column;height:100vh;}
header{background:var(--primary);color:white;padding:1rem;text-align:center;font-weight:600;}
#chat-container{flex:1;overflow-y:auto;padding:1rem;display:flex;flex-direction:column;gap:1rem;}
.message{max-width:80%;padding:.75rem 1rem;border-radius:1rem;line-height:1.5;}
.user{align-self:flex-end;background:var(--primary);color:white;}
.bot{align-self:flex-start;background:var(--card);border:1px solid var(--border);}
.product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:1rem;margin-top:1rem;}
.product-card{border:1px solid var(--border);border-radius:.5rem;background:white;text-align:center;padding:.5rem;transition:.2s;}
.product-card:hover{transform:scale(1.02);}
.product-card a{color:var(--primary);font-size:0.85rem;text-decoration:none;}
#input-area{display:flex;padding:1rem;gap:.5rem;background:white;border-top:1px solid var(--border);}
#user-input{flex:1;padding:.75rem;border:1px solid var(--border);border-radius:.5rem;}
button{padding:.75rem 1rem;border:none;border-radius:.5rem;font-weight:600;cursor:pointer;}
#send-btn{background:var(--primary);color:white;}
#mic-btn{background:var(--success);color:white;}
footer{text-align:center;padding:.5rem;font-size:.8rem;color:#94a3b8;border-top:1px solid var(--border);}
.loading{font-style:italic;color:#64748b;}
</style>
</head>
<body>
<header>üõçÔ∏è AI Live Shopping Chatbot</header>
<div id="chat-container"></div>
<div id="input-area">
<input id="user-input" type="text" placeholder="Search for live products..."/>
<button id="send-btn">Send</button>
<button id="mic-btn">üé§</button>
</div>
<footer>Powered by Google Search API & FastAPI Backend</footer>

<script>
const chat=document.getElementById("chat-container");
const input=document.getElementById("user-input");
const sendBtn=document.getElementById("send-btn");
const micBtn=document.getElementById("mic-btn");
const BACKEND="http://localhost:5000/api";

// Helpers
const addMessage=(text,sender="bot")=>{const m=document.createElement("div");m.className=`message ${sender}`;m.innerHTML=text;chat.appendChild(m);chat.scrollTop=chat.scrollHeight;};
const replaceLast=(html)=>chat.lastChild.innerHTML=html;

// Fetch live deals from backend
async function fetchLiveDeals(query){
    try{
        const res=await fetch(`${BACKEND}/live-deals?query=${encodeURIComponent(query)}`);
        const data=await res.json();
        return data.products||[];
    }catch{return [];}
}

// Render product cards
const renderProducts=(products)=>{
    if(!products.length){addMessage("<em>No products found.</em>"); return;}
    let html='<div class="product-grid">';
    products.forEach(p=>{
        html+=`<div class="product-card">
        <h4>${p.title}</h4>
        <p>${p.snippet}</p>
        <a href="${p.link}" target="_blank">View ‚Üí</a>
        </div>`;
    });
    html+='</div>';
    addMessage(html);
}

// Process user query
async function processQuery(q){
    addMessage(`<span class="loading">Searching live products...</span>`);
    const products=await fetchLiveDeals(q);
    replaceLast(`<strong>Results for "${q}":</strong>`);
    renderProducts(products);
}

// Events
sendBtn.onclick=()=>{const q=input.value.trim();if(!q)return;addMessage(q,"user");input.value="";processQuery(q);};
input.onkeypress=e=>{if(e.key==="Enter") sendBtn.click();};

// Speech recognition
if("SpeechRecognition" in window || "webkitSpeechRecognition" in window){
    const recognition=new(window.SpeechRecognition||window.webkitSpeechRecognition)();
    recognition.lang="en-US"; recognition.interimResults=false;
    micBtn.onclick=()=>{micBtn.disabled=true; micBtn.textContent="üéôÔ∏è"; recognition.start();}
    recognition.onresult=e=>{input.value=e.results[0][0].transcript; micBtn.disabled=false; micBtn.textContent="üé§"; sendBtn.click();}
    recognition.onerror=()=>{micBtn.disabled=false; micBtn.textContent="üé§"; addMessage("Voice input failed.","bot");}
    recognition.onend=()=>{micBtn.disabled=false; micBtn.textContent="üé§";}
}

// Welcome
window.onload=()=>addMessage("üëã Ask for live products from Amazon, Alibaba, Jumia, etc. Try: 'best budget smartphone'");
</script>
</body>
</html>
